WEBVTT

00:00:01.333 --> 00:00:03.766
Improving the Exploit

00:00:04.266 --> 00:00:09.233
The default exit method of Metasploit
shellcode following its execution

00:00:09.233 --> 00:00:12.300
is the ExitProcess API.

00:00:12.766 --> 00:00:17.333
This exit method will shut down the whole
web service process

00:00:17.333 --> 00:00:19.433
when the reverse shell is terminated,

00:00:19.700 --> 00:00:24.466
effectively killing the SyncBreeze
service and causing it to crash.

00:00:25.666 --> 00:00:29.066
If the program we are exploiting is a
threaded application,

00:00:29.066 --> 00:00:34.033
and in this case it is, we can try to
avoid crashing the service completely

00:00:34.033 --> 00:00:38.300
by using the ExitThread API instead,

00:00:38.300 --> 00:00:42.766
which only terminates the affected
thread of the program.

00:00:43.466 --> 00:00:48.100
This will make our exploit work without
interrupting the usual operation

00:00:48.100 --> 00:00:53.233
of the SyncBreeze server, and will allow
us to repeatedly exploit the server

00:00:53.233 --> 00:00:56.866
and exit the shell without bringing down
the service.

00:00:58.300 --> 00:01:04.200
To instruct msfvenom to use the ExitThread
method during shellcode generation,

00:01:04.200 --> 00:01:08.700
we can use the EXITFUNC=thread option.

00:01:12.000 --> 00:01:15.433
Let’s replace the shellcode in our exploit
with this one.

00:01:27.966 --> 00:01:32.566
Once again, we’ll establish our Netcat
listener on port 443,

00:01:46.800 --> 00:01:49.000
and re-run our exploit.

00:01:55.733 --> 00:01:58.800
Everything still appears to be working.

00:01:59.000 --> 00:02:03.800
Let’s re-establish our netcat listener and
try the exploit again

00:02:03.800 --> 00:02:07.966
to see if Syncbreeze is still running and
exploitable.

00:02:27.491 --> 00:02:33.300
Excellent, Sync Breeze no longer crashes
after we exit our shell.
