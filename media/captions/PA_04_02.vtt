WEBVTT

00:00:01.328 --> 00:00:04.328
Passing the Hash in Windows

00:00:04.328 --> 00:00:07.433
As we’ll discover in the next section,

00:00:07.447 --> 00:00:11.233
cracking password hashes can be
very time-consuming 

00:00:11.233 --> 00:00:15.766
and is often not feasible without
powerful hardware. 

00:00:15.766 --> 00:00:20.533
However, sometimes we can leverage
Windows-based password hashes 

00:00:20.533 --> 00:00:24.366
without resorting to a laborious
cracking process.

00:00:25.695 --> 00:00:30.079
The Pass-the-Hash technique allows an
attacker to authenticate 

00:00:30.079 --> 00:00:36.533
to a remote target by using a valid
combination of username and hash

00:00:36.533 --> 00:00:39.500
 rather than a clear text password.

00:00:39.500 --> 00:00:46.566
This is possible because LM and NTLM
password hashes are not salted

00:00:46.572 --> 00:00:49.566
and remain static between sessions.

00:00:49.566 --> 00:00:54.000
Moreover, if we discover a password hash
on one target, 

00:00:54.000 --> 00:00:57.467
we can not only use it to authenticate
to that target, 

00:00:57.467 --> 00:01:01.187
we can use it to authenticate to
another target as well, 

00:01:01.187 --> 00:01:06.700
as long as that target has an account with
the same username and password.

00:01:07.111 --> 00:01:11.066
Let’s introduce a scenario to demonstrate
this attack.

00:01:13.500 --> 00:01:17.533
During our assessment, we discovered a
local administrative account

00:01:17.533 --> 00:01:20.633
 that is enabled on multiple systems.

00:01:20.633 --> 00:01:24.233
We exploited a vulnerability on one of
these systems 

00:01:24.233 --> 00:01:26.909
and have gained SYSTEM privileges,

00:01:26.909 --> 00:01:31.866
allowing us to dump local LM and
NTLM hashes.

00:01:31.866 --> 00:01:35.586
We have copied the hash of a user in the
administrator's group,

00:01:35.586 --> 00:01:41.166
and can now use it instead of a password
to gain access to a different machine, 

00:01:41.166 --> 00:01:44.633
which has the same local administrator
account and password.

00:01:44.981 --> 00:01:50.978
To do this, we will use pth-winexe from
the Passing-The-Hash toolkit, 

00:01:50.978 --> 00:01:55.233
which performs authentication
using the SMB protocol.

00:01:56.530 --> 00:02:01.958
As a demonstration, we’ll invoke
pth-winexe on our Kali machine 

00:02:01.958 --> 00:02:07.333
to authenticate to our target using a
previously dumped password hash.

00:02:07.333 --> 00:02:10.800
We’ll gain a remote command prompt on the
target machine

00:02:10.800 --> 00:02:16.066
 by specifying the user name and hash
separated by a % sign,

00:02:16.933 --> 00:02:21.000
along with the SMB share in UNC format 

00:02:21.000 --> 00:02:26.866
and the name of the command to execute,
which in this case is cmd.

00:02:28.479 --> 00:02:30.900
Our command was successful. 

00:02:30.900 --> 00:02:35.833
Using the captured hash as credentials,
we now have a shell on the target.

00:02:38.648 --> 00:02:42.969
Behind the scenes, the format of the NTLM
hash we provided 

00:02:42.969 --> 00:02:48.300
was changed into NetNTLM format
during the authentication process.

00:02:49.979 --> 00:02:53.600
We can capture these hashes using
man-in-the-middle 

00:02:53.600 --> 00:02:58.833
or poisoning attacks and either
crack them or relay them.
