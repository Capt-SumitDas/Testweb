WEBVTT

00:00:01.500 --> 00:00:06.200
Windows Uploads Using Windows 
Scripting Languages

00:00:06.200 --> 00:00:10.800
In certain scenarios, we may need to 
exfiltrate data from a target network 

00:00:10.800 --> 00:00:13.200
using a Windows client.

00:00:13.200 --> 00:00:17.166
Fortunately, if outbound HTTP traffic 
is allowed

00:00:17.166 --> 00:00:21.833
we can use the System.Net.WebClient 
PowerShell class

00:00:21.833 --> 00:00:27.466
to upload data to our Kali machine 
through an HTTP POST request.

00:00:28.816 --> 00:00:31.900
To do this, we can use this PHP code, 

00:00:31.900 --> 00:00:35.500
 which will process an incoming file 
upload request 

00:00:35.500 --> 00:00:41.233
and save the transferred data to the 
/var/www/uploads directory.

00:00:42.633 --> 00:00:45.633
We will create the uploads folder…

00:00:47.666 --> 00:00:53.900
…and modify the folder permissions, 
granting the www-data user ownership 

00:00:53.900 --> 00:00:55.600
and write permissions.

00:00:59.833 --> 00:01:04.233
Note that this would allow anyone 
interacting with upload.php 

00:01:04.233 --> 00:01:07.600
to upload files to our Kali 
virtual machine.

00:01:11.950 --> 00:01:16.800
Generally, we would want to exfiltrate 
some interesting documents we found,

00:01:16.800 --> 00:01:19.333
but for the purposes of 
this demonstration,

00:01:19.333 --> 00:01:24.833
we'll simply exfiltrate the evil.exe
binary to our Kali attack machine.

00:01:25.166 --> 00:01:29.400
With Apache and the PHP script ready to 
receive our file,

00:01:29.400 --> 00:01:35.333
we invoke the UploadFile method 
from the System.Net.WebClient class

00:01:35.333 --> 00:01:38.533
to upload the document we want 
to exfiltrate.

00:01:39.033 --> 00:01:43.433
After executing the powershell command, 
we can verify that the file 

00:01:43.433 --> 00:01:45.866
was successfully transferred.

00:01:49.316 --> 00:01:54.533
Excellent, we were able to upload data 
from Windows to our Kali system

00:01:54.533 --> 00:01:57.766
without installing any additional 
software.
